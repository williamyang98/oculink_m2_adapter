---
title: Structures
prev: /docs/design/transmission_line
next: /docs/design/transmission_line/skew_requirements
weight: 1
params:
  icon: switch-horizontal
---

PCIe receive and transmit lanes and reference clock are high frequency differential signals. There are many possible designs for a differential transmission line.

{{< responsive_image key="sierra_express_differential_pair_topologies" >}}

## Common mode noise
In theory a perfectly balanced differential pair would only need two conductors to handle the symmetrical current path however this should not be relied upon.
- Common mode noise can arise due to power supply differences between host and device. This is especially important because we have a laptop powered by a USB C dock and an eGPU powered by a separate power supply.
- Without a ground plane or coplanar ground trace the return current for the common mode signal may be over a large loop area.
    - This can pickup interference from environmental sources and harm signal integrity.
    - Increases amount of EMI induced in signal traces within that loop area.

## Crosstalk
Given our tight routing requirements our PCIe lanes would be extremely close together by only a few multiples of the trace width. This means we need to be very careful about inter-lane crosstalk.
- Can be fixed by increasing separation between lanes which might not be possible given our tight space requirements.
- Adding a ground plane to confine the electric field generated by the differential pair (almost always helps).
- Adding coplanar guard traces to separate adjacent lanes and add additional E-field confinement.
    - Sometimes can worsen crosstalk if guard trace is high impedance and functions closer to a resonant tank than a ground trace.
    - Can be improved by turning coplanar guard traces into a via fence by stitching them to a ground plane 
    - This guarantees coplanar guard trace is low impedance.
    - Also adds additional grounding with vias which further improves E-field confinement.

## Best design
The differential pair transmission line with a solid ground plane, coplanar guard traces, and a via fence is the ideal candidate to: reduce crosstalk, handle common mode noise, and reduce EMI emissions.



## Via jumps
If transmission lines have via jumps they must not have stubs and should use backdrilling to remove them.


## Via fence
- Limitation on design options set by price and fabrication (minimum via size and annular ring)
- Spacing requirements and equation for spacing for maximum design frequency

- Staggered via fence performance better than regular via fence
- Requries micro vias and buried vias which JLCPCB does not support

## Skin effect
- Copper thickness and surface roughness
- Effect at higher frequencies
- Difficulty modelling this with tools and available simulation software
- Lack of availability without moving to HDI stackup which is more expensive

### Design resources
- {{< pdf_link key="texas_instrument_pcie4_layout_guidelines" >}}
- {{< website_link key="altium_backdrilling_stubs" >}}
- {{< website_link key="altium_via_stitching" >}}
- {{< website_link key="altium_copper_roughness" >}}
- {{< website_link key="hackaday_rf_via_fence" >}}

